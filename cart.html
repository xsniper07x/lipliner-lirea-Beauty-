<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cart</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
  #cart ul { list-style:none; padding:0; }
  #cart li { display:flex; justify-content:space-between; align-items:center; padding:5px 0; border-bottom:1px solid #ccc; }
  button { cursor:pointer; padding:5px 10px; margin-left:5px; }
  .remove-btn { background:red; color:white; border:none; }
  .qty-btn { background:#25d366; color:white; border:none; }
  #cartActions { margin-top:20px; }
</style>
</head>
<body>

<h2>Your Cart</h2>
<div id="cart"></div>

<div id="cartActions">
  <button id="clearCart">Clear Cart</button>
  <button id="sendWhatsApp">Send via WhatsApp</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function renderCart() {
  const cartDiv = document.getElementById("cart");
  if(cart.length === 0) {
    cartDiv.innerHTML = "<p>Your cart is empty.</p>";
    return;
  }

  let total = 0;
  cartDiv.innerHTML = "<ul>";
  cart.forEach((item, index) => {
    total += item.price * item.qty;
    cartDiv.innerHTML += `
      <li>
        <span>${item.name} x ${item.qty} - $${item.price*item.qty}</span>
        <div>
          <button class="qty-btn" onclick="changeQty(${index}, 1)">+</button>
          <button class="qty-btn" onclick="changeQty(${index}, -1)">-</button>
          <button class="remove-btn" onclick="removeItem(${index})">x</button>
        </div>
      </li>
    `;
  });
  cartDiv.innerHTML += `</ul><p><strong>Total: $${total}</strong></p>`;
}

function changeQty(index, delta) {
  cart[index].qty += delta;
  if(cart[index].qty <= 0) cart.splice(index,1);
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

function removeItem(index) {
  cart.splice(index,1);
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

document.getElementById("clearCart").addEventListener("click", () => {
  cart = [];
  localStorage.removeItem('cart');
  renderCart();
});

document.getElementById("sendWhatsApp").addEventListener("click", () => {
  if(cart.length === 0) return alert("Cart is empty!");

  // Encode each line individually, join with %0A for WhatsApp
  let messageLines = cart.map(item => encodeURIComponent(`${item.name} x ${item.qty} - $${item.price*item.qty}`));
  let total = cart.reduce((sum,item) => sum + item.price*item.qty,0);
  let message = messageLines.join('%0A') + '%0A%0ATotal: $' + total;

  let whatsappURL = "https://wa.me/96178783516?text=" + message;
  window.open(whatsappURL, "_blank");
});

renderCart();
</script>

</body>
</html>
